# linux系统启动流程

在内核设计中有两种流派，一种是微内核，一种是单内核。单内核是指把所有功能做成一个程序，各功能以线程来协同工作。而微内核是将每一个功能都是用一个独立的子系统来实现，子系统在一个框架下统一调配。Linux是单内核设计，Windows和Solaris是微内核设计的。

linux的内核支持模块（kernel object）化、模块的动态装载和卸载。内核文件由核心文件和模块文件组成，内核的核心文件在/boot/vmlinuz-VERSION-release，模块文件在/lib/modules/-VERSION-release

ramdisk在/boot/initrd-VERSION-release.img(centos5),/boot/initramfs-VERSION-release.img(centos6/7)

## CentOS 5/6的启动流程

加电自检(POST)：用ROM芯片（CMOS）内部存储的应用程序进行检查，CMOS可以通过BIOS(basic input and output system)进行一些设定。

Boot Sequence：按次序查找各引导设备，第一个有引导程序的设备即为本次启动用到的设备。使用的程序是bootloader，bootloader提供一个菜单，允许用户选择要启动系统或不同内核版本；把不同用户选定的内核装载到内存的特定空间中，解压展开后并把系统控制权移交给内核。windows叫做ntloader，linux叫做LILO（古老）和GRUB（GRand Uniform Bootloader），grub目前有两种版本，一种以0.X的，叫做grub legacy，另外一种是1.X，叫做grub2。grub启动有两个阶段，第一阶段叫做1st stage就是在mbr中的bootloader，主要目的就是找到硬盘上的第二阶段，第二阶段在某个分区上。

kernel初始化：探测所以可识别的所有硬件设备，加载硬件驱动程序（有可能会借助于ramdisk加载驱动），以只读方式挂载根文件系统，运行用户空间的第一个应用程序init/systemd。

> init程序的类型
>
> SysV：CentOS5，init，配置文件在/etc/inittab
>
> Upstart：CentOS6，init，配置文件在/etc/inittab、/etc/init/*.conf
>
> Systemd：CentOS7，systemd，配置文件在/usr/lib/systemd/system、/etc/systemd/system

### /sbin/init接力运行

系统运行级别是为了系统的运行或维护等应用目的而设定的，一般分为0-6七个级别。默认级别为3或5，

0：关机	

1：单用户模式single，维护模式，以root用户登录，无需密码

2：多用户模式，会启动网络功能，不启动网络文件系统（NFS）

3：多用户模式，正常模式，默认为文本界面

4：预留级别，同3级别

5：多用户模式，图形界面

6：重启

切换级别使用init 级别数字，查看级别使用runlevel（7不支持），也可以使用who -r

init的配置文件/etc/inittab每一行定义一种action以及与之对应的process。id：runlevel：action：process