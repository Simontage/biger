# 进程和作业管理

内核有进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能等功能。模式切换是在用户模式和内核模式之间切换。

task struct是内核用来存储进程信息的固定格式，多个任务的task struct组成的链表叫做task list。

linux内核设计与实现 

深入理解linux内核

## 进程

### 进程的创建和终止

### 进程的优先

0-139

1-99：实时优先级，数字越大，优先级越大

100-139：静态优先级，数字越小，优先级越高

​	Nice值：-20-19

### 进程如何使用内存

page frame和page

进程的线性地址空间和内存物理地址

MMU：memory management unit

### 进程间的通信

ipc(inter process communication)机制

同一主机：shm（shared memory） semerphor     signal

跨主机：rpc（remote procecure call）socket



linux抢占式多任务

### 进程的类型

守护进程(daemon):在系统引导过程中启动的进程,和终端无关的进程

用户进程/前台进程:和终端相关,通过终端启动的进程,也可以在前台启动的进程,以守护模式运行

 

cpu-bound(cpu密集型)

io-bound(io密集型)

### 进程的状态

运行态:running

就绪态:ready

睡眠态:

​	可中断:interruptable     

​	不可中断:uninerruptable

停止态:暂停于内存中,但不会被调度,除非手动启动

僵死态(zombie)

## linux进程查看及管理工具

常见的命令有pstree、ps、pidof、pgrep、top、htop、glance、

pstree： 显示进程树

ps：process state进程状态快照查看，/proc目录下有大量数字目录，每一个数字都代表一个进程号，每个数字目录下的文件都是进程的状态信息，在数字目录下有一个文件是cmdline可以查看此进程是由哪个命令启动的。

ps支持两种风格的选项格式，

```
常用组合
aux：
	u：以用户为中心组织进程状态信息显示
	a：与终端相关的进程
	x：与终端无关的进程
	中括号表示的是内核线程
-ef：
	-e：显示所有进程
	-f：显示完整格式的程序信息 
-eFH：以层级格式显示进程相关信息
	-F:
	-H:以层级格式显示
-eo [指定要显示的字段]、axo [指定显示的字段]：
	常用的字段有：ni：nice值；pri：优先级；psr：processor CPU；rtptrio：实时优先级；ppid：父进程等
```

> **ps aux各字段的含义**
>
> USER：进程属主
>
> PID：进程id号
>
> vsz：virtual memory size虚拟内存集
>
> rss：resident size常驻内存集
>
> stat：进程状态
>
> ​	R：running
>
> ​	S：interruptable sleeping
>
> ​	D：uninterruptable sleeping
>
> ​	T：stopped
>
> ​	Z：zombie
>
> ​	+：前台进程
>
> ​	l：多线程进程
>
> ​	N：低优先级进程
>
> ​	<：高优先级进程
>
> ​	s：session leader
>
> START：启动时间
>
> TIME：进程运行占用cpu的累计时间.

pgrep、pkill：一般使用格式pgrep|pkill [options] pattern

```
-u uid：effective user
-U uid：real user
-t terminal：与指定终端相关的进程
-l：显示进程名
-a：显示完整格式的进程名
-P pid：显示其父进程为此处指定的进程的进程列表
```

pidof：根据进程名获取其pid。pidof 进程名

- top：进程状态实时查看，有许多内置命令

排序：P：已占据的cpu百分比；M：占据内存百分比；T：累计占用

首部top信息显示和隐藏：L

任务和task信息显示和隐藏：t命令

​	cpu分别显示：数字1

memory信息显示和隐藏：m

退出命令：q

修改刷新时间间隔：s，默认为3秒

终止指定进程：k

``` 
-d number：指定默认刷新频率
-b：以批次方式，-n num：显示多少批次
```

- htop和top相似，但比top命令功能更多一些，安装要使用Fedora-epel源

三个内建命令

s：跟踪选定进程的系统调用

l：显示选定进程打开的文件列表

a：将选定的进程绑定至某指定cpu核心

```
-d num：指定刷新时间
-u uname：仅显示指定用户的进程
-s colomn：以指定字段进行排序
```

### vmstat

vmstate查看虚拟内存状态，比较早期的linux命令，一般使用格式vmstat \[options][delay [count]]  。

![](http://om8bgr2y6.bkt.clouddn.com/vmstat.png)

vmstat各字段含义：

r：等待运行的进程的个数

b：处于阻塞状态（不可中断睡眠态）的进程个数

swpd：交换内存的使用总量

free：空闲物理内存总量

buffer：用于buffer的内存总量

cache：用于cache的内存总量

si：数据进入swap中的数据速率，单位是kb/s

so：数据离开swap的数据速率

bi：从块设备读入数据到系统的速率，单位是kb/s

bo：保存数据到块设备的速率

in：interrupts，中断速率

cs：context switch，进程切换速率

us： 用户空间占据cpu的比例

sy：内核空间占据cpu的比例

id：空闲比例

wa：等待io完成所消耗的时间比例

st：被偷走的时间比例

```
-s：显示统计数据
```

### pmap

pmap报告进程的内存映射关系，一般使用格式pmap [options] pid

```
-x：显示详细格式的信息
```

pmap实际上也是读取/proc/PID/maps文件

### glances

glances是一个跨平台的监控工具，还支持cs架构，glances也有很多内建命令，使用h获取帮助

```
-b：以字节byte为单位显示网卡速率
-d：关闭磁盘io模块
-f /path/to/somewhere：输出文件位置及其格式
-o {HTML|CSV}：输出格式
-m：禁用mount模块
-n：禁用网络模块
-t num：延迟时间间隔
-l：每个cpu的相关数据单独显式
```

c/s模式的glances使用

服务模式：glances  -s -B IPADDR（指明监听于本机的哪个地址）

客户端模式：glances -c IPADDR（要连入的服务器地址）

### dstat

是vmstat的替换工具， 统计系统资源并显示

```
-c：显示cpu的相关信息，dstat默认会显示cpu的相关信息
-C：单独指定某颗cpu的信息
-d：显示磁盘的读写速率，默认显示
-D：单独显示指定的某块硬盘
-g：显示page的相关信息
-i：显示中断的统计信息
-l：显示load的统计信息
-m：显示memory相关统计信息
-n：显示network相关统计信息
-p：显示进程统计数据
-r：显示io请求
```

