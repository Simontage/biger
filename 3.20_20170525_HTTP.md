# HTTP

计算机网络通信模型有OSI参考模型和当前正在使用TCP/IP模型

![](http://om8bgr2y6.bkt.clouddn.com/OSI_Vs_TCPIP_Model.png)



从linux的角度看计算机网络的通信模型，物理层是通过硬件实现的，数据链路层是通过相关硬件的驱动程序实现的，网络层和传输层在内核中实现，应用层在用户空间实现。

应用层的重点是不同的程序实现特有的一些功能，TCP/IP的下三层更通用，重点是数据的传送

物理层提供设备到设备的通信，网络层提供主机到主机的通信，传输层为进程提供端到端的通信服务，传输层使用端口来区分各个进程，传输层使用的协议常用的有两种，TCP和UDP

网络通信实际上也是两个进程之间的通信，套接字(Socket)是进程通信的一种方式，允许位于不同主机的不同进程进行通信，套接字是进程间数据流的端点，以IP协议为通信基础的套接字称为网络套接字，以本地文件系统通信的套接字称为Unix Socket。

套接字有三种类型，一种是以TCP为基础的SOCK_STREAM，一种是以UDP为基础的SOCK_DGRAM，还有一种直接以IP为基础的raw socket

IANA将0-1023的端口已经永久分配给固定的应用使用，叫做特权端口；1024-41951范围内的端口也是由IANA进行注册的端口，但要求不严格，可分配给开发者注册为某应用使用；41952之后的端口是客户端随机使用的端口，也叫做动态端口或私有端口，其范围由/proc/sys/ipv4/ip_local_port_range文件定义。

客户端和服务端组成一组套接字，服务端使用固定的端口监听，客户端使用随机端口。

Socket Domain根据所使用的地址不同，Socket分为AF_INET、AF_INET6、AF_UNIX。

- AF_INET
- AF_INET6
- AF_UNIX：同一主机上不同的进程通信时使用

每类套接字都至少提供了两种Socket数据传输机制：流和数据报。流可以可靠地传递并且是面向连接的，而且是无边界的；数据报是不可靠地传递，报文有边界、无连接。

与套接字相关的系统调用有

- socket()：创建套接字
- bind()：绑定套接字
- listen()：监听套接字
- accept()：接受请求
- connect()：请求连接建立
- write()：发送
- read()：接收

## HTTP基础

C/S架构是一种网络架构，分为客户端和服务端，客户端和服务端要使用相同的协议才可以正常的通信，C/S架构最常见的就是在互联网所浏览的网页，使用的http协议，http是超文本传输协议，监听在tcp80端口，用来传输使用html标记的文件，http的客户端是browser，服务端是http server

MIME的引入使html可以支持多媒体，将文本数据编码为文本数据，客户端将文本还原为非文本数据

http的请求对象内容叫做web资源(web resource)，静态文件是最基本的资源，如文本、音频、视频，web资源也有动态资源，如php、jsp

资源(媒体)有类型，又称为MIME类型，有主类型和次类型major/minor，如text/html、text/plain、image/gif

每个资源的唯一标识符叫做URL，url是统一资源定位符，是URI的子集，URI是统一资源标识符。url用于描述某服务器特定资源的位置

URL的格式：Scheme://Server:port/resource

http协议的版本

- HTTP/0.9：原型版本
- HTTP/1.0：第一个广泛使用的版本，支持MIME，有缓存缺陷
- HTTP/1.1：广泛使用的版本
- HTTP/2.0：

一次完整的HTTP请求处理过程

1、建立或处理连接：接收或拒绝请求

2、接收请求：接收来自于来自于网络请求报文中对某一资源的一次请求过程

3、处理请求：对请求报文进行解析，并获得请求的资源及请求方法等相关信息

​	请求报文的首部有请求方法、url、请求主机名称、Connection等

4、访问资源：获取请求报文中请求的资源。

​	web服务器即存放了web资源的服务器，负责像请求者提供对方请求的静态资源或动态运行后生成的资源，这些资源放置于本地文件系统某路径下，此路径通常称为DocRoot

5、构建响应报文：

​	标记资源的MIME类型：显示分类、魔法分类、协商分类

​	web服务器构建的响应并非客户端请求的资源，而是资源的另外一个访问路径，这叫做URL重定向

6、发送响应报文

7、记录日志

服务端接收请求时的并发访问模型（web i/o）

- 单线程IO结构：一次处理一个请求，多个请求响应被串行响应
- 多线程IO结构：启动多个线程，每个线程响应一个一个请求
- 复用IO结构：一个进程响应多个请求，使用多线程模型或事件驱动机制
- 复用多线程IO结构：启动多个进程，每个进程响应多个请求

服务端资源映射方式

- Docroot
- 路径别名
- 虚拟主机Docroot映射
- 用户家目录docroot映射

