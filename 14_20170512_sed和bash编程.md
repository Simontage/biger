## sed和bash编程

## sed

vi是交互式的编辑工具，而sed(Stream Editor) 是一个行编辑器，一般格式为`sed [option]... '定界编辑' file...`，既可以使用双引号也可以使用单引号，如果要进行变量替换则要使用双引号。

sed每次读取一行，不会编辑原文件，基于编辑脚本对模式空间中的内容进行编辑，把处理后的结果输出至屏幕。

常用选项

```
-n：静默模式，不输出模式空间中的内容至屏幕，sed默认会把读入的一行输出到标准输出，修改的结果也会输出。
-e: 多点编辑 -e 'script' -e 'script'
-f /PATH/TO/SCRIPT_FILE: 从指定文件中读取编辑脚本
-r: 使用扩展正则表达式
-i: 原处编辑
```

地址定界

(1)不给范围:对全文进行处理

(2)单地址:    #指定的行   |   /pattern/：被此处模式所能够匹配到的每一行；

(3)地址范围:#,#   |   #,+#   |   /pat1/,/pat2/   | #,/pat1/  

**sed的编辑命令**

d: 删除 如sed '1,3d' /etc/fstab   |      sed ‘/^#/d’ /etc/fstab          |      sed  ‘/^\//d’ /etc/fstab

p: 显示模式空间中的内容，所以能被匹配到的显示两次，不能被匹配到的显示一次。和-n合用只显示匹配到的行

a \text：在行后面追加文本；支持使用\n实现多行追加；

i \text：在行前面插入文本；支持使用\n实现多行插入；

c \text：替换行为单行或多行文本；

w /path/to/somefile: 将符合条件的所有行保存到指定的文件中，覆盖式保存。

r /path/from/somefile：在指定位置把另外一个文件的内容插入进来

=: 显示符合条件的行的行号

!: 对地址定界取反 ; 

s/要查找的内容/要替换的内容/：查找替换，支持使用其它分隔符，s@@@，s###。查找条件可以使用模式，替换不可使用模式。sed ‘地址定界s@查找条件@替换文本’  file。地址定界就表示只对指定范围内行做查找。

​	替换标记

​		g: 行内全局替换；

​		i：匹配时不区分字符大小写

​		p: 显示替换成功的行；

​		w /PATH/TO/SOMEFILE：将替换成功的结果保存至指定文件中；

删除/boot/grub/grub.conf文件中所有以空白开头的行行首的所有空白字符；

```
sed 's@^[[:space:]]\{1,\}@@' /boot/grub/grub.conf
```

删除/etc/fstab文件中所有以#开头，后面至少跟一个空白字符的行的行首的#和空白字符；

```
sed 's@^#[[:space:]]\+@@' /etc/fstab
```

echo一个绝对路径给sed命令，取出其基名；取出其目录名；

```
echo "/etc/sysconfig/" | sed 's@[^/]\+/\?$@@'
```

替换/etc/inittab文件中”id:3:initdefault:"一行中的数字为5

```
sed 's@\(id:\)[0-9]\(:initdefault\)@\15\2' /etc/inittab 
```

删除/etc/init.d/funcions文件中的空白行

```
sed "/^$/d" /etc/init.d/funcions
```

删除/etc/inittab文件中位于行首的#

```
sed 's@^#@@g' /etc/inittab
```

删除/etc/rc.d/rc.sysinit文件中以#后跟至少一个空白字符开头的行的行首的#和空白字符

```
 sed "s@^#[[:space:]]\{1,\}\@@g" /etc/rc.d/rc.sysinit
```

取出一个文件路径的目录名称，如/etc/sysconfig/network,其目录为/etc/sysconfig,功能类似dirname命令；

```
echo /etc/sysconfig/network | sed 's@[^/]/{1,\}\/?$@@'
```

**高级编辑命令：**

h: 把模式空间中的内容覆盖至保持空间中；
H：把模式空间中的内容追加至保持空间中；
g: 从保持空间取出数据覆盖至模式空间；
G：从保持空间取出内容追加至模式空间；
x: 把模式空间中的内容与保持空间中的内容进行互换；
n: 读取匹配到的行的下一行至模式空间；
N：追加匹配到的行的下一行至模式空间；
d: 删除模式空间中的行；
D：删除多行模式空间中的所有行；

## bash编程

### until循环

until的使用格式

```
until CONDITION; do
	循环体
done

进入条件：CONDITION为false
退出条件：CONDITION为true
```

求100以内所有正整数之和

```shell
#!/bin/bash
declare -i i=1
declart -i sum=0
until [ $i -gt 100 ];do
	let sum+=$i
	let i++
done
echo "sumary:$sum"
```

打印九九乘法表

```shell
#!/bin/bash
declare -i j=1
declare -i i=1
until [ $j -gt 9 ]; do
	until [ $i -gt $j ]; do
		echo -n -e "${i}X${j}=$[$i*$j]\t"
		let i++
	done
	echo
	let i=1
	let j++
done
```

### 循环控制语句-continue和break

continue和break用于循环体中

```shell
continue [N]：提前结束第N层的本轮循环，而直接进入下一轮判断
while CONDTIITON1; do
	CMD1
	...
	if CONDITION2; then
		continue
	fi
	CMDn
	...
done
```

```shell
break [N]：提前结束循环				
while CONDTIITON1; do
	CMD1
	...
	if CONDITION2; then
		break
	fi
	CMDn
	...
done
```

求100以内所有偶数之和；要求循环遍历100以内的所正整数；

```shell
#!/bin/bash
declare -i i=0
declare -i sum=0
until [ $i -gt 100 ];do
	let i++
	if [ $[$i%2] -eq 1 ];then
		continue
	fi
	let sum+=$i
done
echo 'even sum:$sum'
```

### 创建死循环

```
whhile true; do
	循环体
done

until false; do
	循环体
done
```

每隔3秒钟到系统上获取已经登录的用户的信息；如果docker登录了，则记录于日志中，并退出；

```shell

```

